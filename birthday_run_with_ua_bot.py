import json
from datetime import datetime
import random
import time
from telegram.ext import Updater, CallbackContext

# –ó—á–∏—Ç—É–≤–∞–Ω–Ω—è –¥–∞–Ω–∏—Ö –∑ JSON-—Ñ–∞–π–ª—É
def load_user_data():
    try:
        with open('user_data.json', 'r') as file:
            data = json.load(file)
        return data
    except FileNotFoundError:
        return []

def send_birthday_greetings_to_chat(users: list, context: CallbackContext):
    today_day, today_month = datetime.now().strftime('%d/%m').split('/')

    for user in users:
        user_birthday = user['birthday']
        user_nickname = user['telegram_nickname']
        user_insta_profile = user['instagram_link']
        user_gender = user.get('gender', 'unknown')

        user_day, user_month, _ = user_birthday.split('/')

        if user_day == today_day and user_month == today_month:
            chat_id = user['user_id']

            non_birthday_greetings = [
                "üèÉ‚Äç‚ôÇÔ∏è –ù–µ—Ö–∞–π –∫–æ–∂–µ–Ω –¥–µ–Ω—å –±—É–¥–µ –¥–ª—è —Ç–µ–±–µ –Ω–æ–≤–∏–º –∑–∞–±—ñ–≥–æ–º –¥–æ –ø–µ—Ä–µ–º–æ–≥!\n",
                "üåü –ó–∏—á–∏–º–æ —è—Å–∫—Ä–∞–≤–∏—Ö —Ç—Ä–µ–Ω—É–≤–∞–Ω—å —Ç–∞ –±–∞–≥–∞—Ç–æ –Ω–µ–π–º–æ–≤—ñ—Ä–Ω–∏—Ö –¥–æ—Å—è–≥–Ω–µ–Ω—å!\n",
                "üë£ –ù–µ—Ö–∞–π –∫–æ–∂–µ–Ω –∫—Ä–æ–∫ –ø—Ä–∏–Ω–æ—Å–∏—Ç—å —Ç–æ–±—ñ —Ä–∞–¥—ñ—Å—Ç—å —Ç–∞ –∑–∞–¥–æ–≤–æ–ª–µ–Ω–Ω—è!\n",
                "üèÜ –ë–∞–∂–∞—î–º–æ –≤–ø–µ–≤–Ω–µ–Ω–æ—Å—Ç—ñ –Ω–∞ —Ç—Ä–∞—Å—ñ —Ç–∞ —Å–∏–ª –¥–ª—è –ø–æ–¥–æ–ª–∞–Ω–Ω—è –±—É–¥—å-—è–∫–∏—Ö –≤–∏–∫–ª–∏–∫—ñ–≤!\n",
                "üåû –ù–µ—Ö–∞–π —Å–æ–Ω—Ü–µ –∑–∞–≤–∂–¥–∏ —Å–≤—ñ—Ç–∏—Ç—å –Ω–∞ —Ç–≤–æ—î–º—É –±—ñ–≥–æ–≤–æ–º—É —à–ª—è—Ö—É!\n",
                "üåø –ó–∏—á–∏–º–æ –±—ñ–≥–æ–≤–æ—ó –≥–∞—Ä–º–æ–Ω—ñ—ó —Ç–∞ –∑–¥–æ—Ä–æ–≤'—è –Ω–∞ –∫–æ–∂–Ω–æ–º—É –∫—Ä–æ—Ü—ñ!\n",
                "üëü –ë—É–¥—å –∑–∞–≤–∂–¥–∏ —à–≤–∏–¥–∫–∏–º, —è–∫ –≤—ñ—Ç–µ—Ä, —Ç–∞ —Å—Ç—ñ–π–∫–∏–º, —è–∫ –≥–æ—Ä–∏!\n",
                "üå∫ –ù–µ—Ö–∞–π –∫–æ–∂–µ–Ω –º–µ—Ç—Ä —Ç–≤–æ–≥–æ –±—ñ–≥—É –±—É–¥–µ –Ω–∞–ø–æ–≤–Ω–µ–Ω–∏–π –ø–æ–∑–∏—Ç–∏–≤–æ–º —Ç–∞ –≤–¥—è—á–Ω—ñ—Å—Ç—é!\n",
                "üöÄ –ë–∞–∂–∞—î–º–æ –Ω–∞–¥–∑–≤–∏—á–∞–π–Ω–∏—Ö –∑–¥—ñ–±–Ω–æ—Å—Ç–µ–π —Ç–∞ –≤—Ä–∞–∂–∞—é—á–∏—Ö —Ä–µ–∫–æ—Ä–¥—ñ–≤!\n",
                "üåÑ –ù–µ—Ö–∞–π —Ç–≤—ñ–π –±—ñ–≥ –ø—Ä–æ–∫–ª–∞–¥–∞—î —à–ª—è—Ö –¥–æ –Ω–æ–≤–∏—Ö –≥–æ—Ä–∏–∑–æ–Ω—Ç—ñ–≤!\n",
                "üí™ –ó–¥–æ—Ä–æ–≤'—è, —Å–∏–ª–∏ —Ç–∞ –Ω–µ—Å–∫—ñ–Ω—á–µ–Ω–Ω–æ—ó –µ–Ω–µ—Ä–≥—ñ—ó –Ω–∞ —Ç—Ä–∞—Å—ñ –∂–∏—Ç—Ç—è!\n",
                "üåà –ù–µ—Ö–∞–π –∫–æ–∂–µ–Ω –±—ñ–≥–æ–≤–∏–π –¥–µ–Ω—å –±—É–¥–µ –¥–ª—è —Ç–µ–±–µ —Å–≤—è—Ç–æ–º —Ä–∞–¥–æ—Å—Ç—ñ!\n",
                "üå≥ –ó–∞–≤–∂–¥–∏ –∑–Ω–∞—Ö–æ–¥—å –ø—ñ–¥—Ç—Ä–∏–º–∫—É —É –ø—Ä–∏—Ä–æ–¥—ñ —Ç–∞ —Å–≤–æ—ó—Ö –≤–ª–∞—Å–Ω–∏—Ö –º–æ–∂–ª–∏–≤–æ—Å—Ç—è—Ö!\n",
                "üåü –ë—ñ–∂–∏ —Ç–∞–∫, –Ω–∞—á–µ –∫–æ–∂–µ–Ω –¥–µ–Ω—å - —Ü–µ –Ω–æ–≤–∏–π —Å—Ç–∞—Ä—Ç –¥–æ –ø–µ—Ä–µ–º–æ–≥!\n",
                "üéä –ó–∏—á–∏–º–æ –±—ñ–≥–æ–≤–æ–≥–æ –µ–∫—Å—Ç–∞–∑—É —Ç–∞ –≤—ñ–¥—á—É—Ç—Ç—è —Å–≤–æ–±–æ–¥–∏ –Ω–∞ –∫–æ–∂–Ω–æ–º—É –∫—ñ–ª–æ–º–µ—Ç—Ä—ñ!\n"
            ]  # –î–æ–¥–∞–π—Ç–µ –∫–æ–º—É –ø—ñ—Å–ª—è –æ—Å—Ç–∞–Ω–Ω—å–æ–≥–æ –µ–ª–µ–º–µ–Ω—Ç–∞, —è–∫—â–æ –¥–æ–¥–∞—î—Ç–µ –Ω–æ–≤—ñ —Ä—è–¥–∫–∏

            birthday_greetings_for_men = [
                "üèÉ‚Äç‚ôÇÔ∏è –í—ñ—Ç–∞—î–º–æ —Ç–µ–±–µ, –±—ñ–≥—É–Ω–µ, –∑ —á—É–¥–æ–≤–∏–º –î–Ω–µ–º –Ω–∞—Ä–æ–¥–∂–µ–Ω–Ω—è!\n",
                "üéà –ù–µ—Ö–∞–π —Ç–≤–æ—ó –Ω–æ–≥–∏ –∑–∞–≤–∂–¥–∏ –±—É–¥—É—Ç—å —à–≤–∏–¥–∫–∏–º–∏, –∞ —Å–µ—Ä—Ü–µ - –º—ñ—Ü–Ω–∏–º!\n",
                "üéÇ –ó –î–Ω–µ–º –Ω–∞—Ä–æ–¥–∂–µ–Ω–Ω—è, –º–∞–π–±—É—Ç–Ω—ñ–π —á–µ–º–ø—ñ–æ–Ω–µ!\n",
                "üèÜ –í—ñ—Ç–∞—î–º–æ –∑ –î–Ω–µ–º –Ω–∞—Ä–æ–¥–∂–µ–Ω–Ω—è, –º–∞–π—Å—Ç–µ—Ä–Ω—ñ—Å—Ç—å —Ç–∞ –≤–∏—Ç—Ä–∏–≤–∞–ª—ñ—Å—Ç—å –±—ñ–≥—É–Ω–∞!\n",
                # –î–æ–¥–∞–≤–∞–π—Ç–µ —ñ–Ω—à—ñ —Ä—è–¥–∫–∏ –∑ "–∑ –î–Ω–µ–º –Ω–∞—Ä–æ–¥–∂–µ–Ω–Ω—è"
            ]

            birthday_greetings_for_women = [
                "üèÉ‚Äç‚ôÄÔ∏è –í—ñ—Ç–∞—î–º–æ —Ç–µ–±–µ, —Ä–∞–Ω–µ—Ä–∫–æ, –∑ —á—É–¥–æ–≤–∏–º –î–Ω–µ–º –Ω–∞—Ä–æ–¥–∂–µ–Ω–Ω—è!\n",
                "üéà –ù–µ—Ö–∞–π —Ç–≤–æ—ó –Ω–æ–≥–∏ –∑–∞–≤–∂–¥–∏ –±—É–¥—É—Ç—å —à–≤–∏–¥–∫–∏–º–∏, –∞ —Å–µ—Ä—Ü–µ - –º—ñ—Ü–Ω–∏–º!\n",
                "üéÇ –ó –î–Ω–µ–º –Ω–∞—Ä–æ–¥–∂–µ–Ω–Ω—è, –º–∞–π–±—É—Ç–Ω—è —á–µ–º–ø—ñ–æ–Ω–∫–æ!\n",
                "üèÜ –í—ñ—Ç–∞—î–º–æ –∑ –î–Ω–µ–º –Ω–∞—Ä–æ–¥–∂–µ–Ω–Ω—è, –º–∞–π—Å—Ç–µ—Ä–Ω—ñ—Å—Ç—å —Ç–∞ –≤–∏—Ç—Ä–∏–≤–∞–ª—ñ—Å—Ç—å —Ä–∞–Ω–µ—Ä–∫–æ!\n",
                # –î–æ–¥–∞–≤–∞–π—Ç–µ —ñ–Ω—à—ñ —Ä—è–¥–∫–∏ –∑ "–∑ –î–Ω–µ–º –Ω–∞—Ä–æ–¥–∂–µ–Ω–Ω—è" –¥–ª—è –∂—ñ–Ω–æ–∫
            ]

            # –í–∏–±–∏—Ä–∞—î–º–æ 4 —Ä–∞–Ω–¥–æ–º–Ω—ñ —Ä—è–¥–∫–∏ –±–µ–∑ "–∑ –î–Ω–µ–º –Ω–∞—Ä–æ–¥–∂–µ–Ω–Ω—è"
            selected_non_birthday_greetings = random.sample(non_birthday_greetings, 4)

            # –ü–æ—á–∞—Ç–æ–∫ –ø—Ä–∏–≤—ñ—Ç–∞–Ω–Ω—è –∑ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—î—é –ø—Ä–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
            greeting_prefix = f"–ü—Ä–∏–≤—ñ—Ç, {user_nickname} ({user['first_name']} {user['last_name']})!\n "

            # –†–æ–∑–¥—ñ–ª –ø—Ä–∏–≤—ñ—Ç–∞–Ω—å
            first_part_of_greeting = greeting_prefix + " ".join(selected_non_birthday_greetings)

            # –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è selected_birthday_greeting –ø—É—Å—Ç–∏–º —Ä—è–¥–∫–æ–º
            selected_birthday_greeting = ""

            # –í–∏–±—ñ—Ä —Ä–∞–Ω–¥–æ–º–Ω–æ–≥–æ –ø—Ä–∏–≤—ñ—Ç–∞–Ω–Ω—è –∑ –î–Ω–µ–º –Ω–∞—Ä–æ–¥–∂–µ–Ω–Ω—è
            if user_gender.lower() == 'male':
                selected_birthday_greeting = random.choice(birthday_greetings_for_men)
            elif user_gender.lower() == 'female':
                selected_birthday_greeting = random.choice(birthday_greetings_for_women)
            else:
                selected_birthday_greeting = random.choice(birthday_greetings_for_men + birthday_greetings_for_women)

            # –î–æ–¥–∞—î–º–æ –≤–∏–±—Ä–∞–Ω—ñ –ø—Ä–∏–≤—ñ—Ç–∞–Ω–Ω—è –≤ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è
            message = first_part_of_greeting
            if selected_birthday_greeting:
                message += " " + selected_birthday_greeting

            # –î–æ–¥–∞—î–º–æ –∑–∞–∫—ñ–Ω—á–µ–Ω–Ω—è –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è
            message += "–ó–∞–≤–∂–¥–∏ –∑ —Ç–æ–±–æ—é RUN WITH UKRAINEü•≥üéÇ\n"
            message += f"–ú–æ–∂–µ—Ç–µ –ø—Ä–∏–≤—ñ—Ç–∞—Ç–∏ –≤ –Ü–Ω—Å—Ç–∞–≥—Ä–∞–º: {user_insta_profile} üì∏üî•"

            context.bot.send_message(chat_id="-1001267994264", text=message)
            print(f"Sending birthday greetings to {user['first_name']} {user['last_name']}")
            print("Birthday greetings sent successfully!")



def main():
    user_data = load_user_data()
    updater = Updater("–≤–∞—à_—Ç–æ–∫–µ–Ω", use_context=True)  # –ó–∞–º—ñ–Ω—ñ—Ç—å –Ω–∞ –≤–∞—à —Ç–æ–∫–µ–Ω

    # –û—Ç—Ä–∏–º—É—î–º–æ –ø–æ—Ç–æ—á–Ω–∏–π —á–∞—Å
    current_time = datetime.now().strftime("%H:%M:%S")

    # –ó–∞–¥–∞—î–º–æ —á–∞—Å, –∫–æ–ª–∏ –º–∞—î –≤—ñ–¥–ø—Ä–∞–≤–∏—Ç–∏—Å—è –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è
    scheduled_time = "10:00:00"

    # –û—á—ñ–∫—É—î–º–æ –Ω–∞ –Ω–∞—Å—Ç–∞–Ω–Ω—è –∑–∞–ø–ª–∞–Ω–æ–≤–∞–Ω–æ–≥–æ —á–∞—Å—É
    while current_time < scheduled_time:
        current_time = datetime.now().strftime("%H:%M:%S")
        time.sleep(1)

    send_birthday_greetings_to_chat(user_data, updater)
    updater.start_polling()

if __name__ == '__main__':
    main()
